# CHANGELOG

Все значимые изменения проекта документируются в этом файле.

## [2.0.0] - 2025-11-03

### Добавлено
- Генерация промптов через GigaChat с fallback на статические при ошибках.
- Dry-run проверки API:
  - Kandinsky: запрос `/key/api/v1/pipelines` без траты генераций; сохранение списка моделей.
  - GigaChat: получение токена без расхода токенов модели; запрос доступных моделей `GET /api/v1/models`.
- Хранилище моделей `utils/models_store.py` и `data/models.json`:
  - Текущая и доступные модели для Kandinsky и GigaChat.
- Хранилище админов `utils/admins_store.py` и `data/admins.json`.
- Команда `/list_models` (админ): выводит доступные модели обеих систем, отмечает текущие.
- Новые админ-команды: `/force_send`, `/add_chat`, `/remove_chat`, `/list_chats`, `/set_kandinsky_model`, `/set_gigachat_model`, `/mod`, `/unmod`, `/list_mods`.
- Расширенное логирование: подробные debug-логи в dry-run и при сохранении списков моделей.
- Повторные попытки (до 3) при `httpx.ConnectError` для всех команд (отправка сообщений/медиа).

### Изменено
- `/status` доступна только админам и объединяет функциональность старых `/admin_status` и `/health`.
- `/help`: у пользователей убрана информация о логах; показана дата ближайшей авто-отправки. У админов — расширенная справка по новым командам.
- Админ-команды без префикса `admin_` для удобства.
- Метрики: отображаются успешные, всего и процент успеха.
- Убрано ограничение per-user для `/frog` у администраторов.
- Улучшен graceful shutdown: гарантированная отправка финального сообщения перед остановкой компонентов.

### Исправлено
- SSL для GigaChat: поддержка пользовательского сертификата (`GIGACHAT_CERT_PATH`), параметр `GIGACHAT_VERIFY_SSL`.
- Таймауты и обработка сетевых ошибок при запросах к GigaChat (токен/промпт/модели).
- Циклический импорт `utils.config` ↔ `utils.logger` (lazy import).
- Сообщения админам при длинных трассировках: обрезка и отправка короткой версии, защита от `Message is too long`.
- Команда `/status` больше не тратит генерации.

### Удалено
- Команды: `/admin_status`, `/admin_help`, `/health`.

### Технические улучшения
- Логика кэширования и использования сохранённых списков моделей при недоступности API.
- Сохранение не более 30 изображений в `data/frogs` с удалением самых старых.
- Централизованное хранилище конфигураций моделей.

---

## [1.0.0] - 2025-09-01
- Первый релиз бота с генерацией через Kandinsky, планировщиком и базовыми командами `/start`, `/help`, `/frog`.

